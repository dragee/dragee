/*! multidrag 25-02-2014 */
!function(){"use strict";var a,b,c=window.MultiDrag||{};a=function(){this.init()},a.prototype.init=function(){var a=this;this.isListen=!1,this.elListeners=[],this.domListener=b.throttle(function(){a.check()},100)},a.prototype.check=function(){console.log("check");var a=[];this.elListeners.forEach(function(c){var d=c.isDisplay,e=b.isDisplayed(c.el);c.isDisplay=e,!d&&e&&(a=a.concat(c.listetners))}),setTimeout(function(){a.forEach(function(a){a()})},0)},a.prototype.addListener=function(){document.addEventListener("DOMSubtreeModified",this.domListener),this.isListen=!0},a.prototype.removeListener=function(){document.removeEventListener("DOMSubtreeModified",this.domListener),this.isListen=!1},a.prototype.add=function(a,c){var d=b.isDisplayed(a),e=this.elListeners.filter(function(b){return b.el===a})[0];e?e.listetners.push(c):(e={el:a,listetners:[c],isDisplay:d},this.elListeners.push(e),this.isListen||this.addListener()),d&&c()},a.prototype.remove=function(a,c){var d=this.elListeners.filter(function(b){return b.el===a})[0];d&&(b.remove(d.listetners,c),d.listetners.length||(b.remove(this.elListeners,d),this.elListeners.length||this.removeListener()))},b={addClass:function(a,b){this.hasClass(a,b)||(a.className=(a.className+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g," "))},removeClass:function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},hasClass:function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");return c.test(a.className)},toggleClass:function(a,b,c){var d=arguments.length>2?c:!this.hasClass(a,b);this[d?"addClass":"removeClass"](a,b)},getDefaultParent:function(a){for(var b=a.parentNode;b.parentNode&&"static"===window.getComputedStyle(b).position;)b=b.parentNode;return b},bind:function(a,b){return function(){return a.apply(b,[].splice.call(arguments,0))}},getTouchByID:function(a,b){var c;for(c=0;c<a.changedTouches.length;c++)if(a.changedTouches[c].identifier===b)return a.changedTouches[c];return!1},getSumValueOfStyleRule:function(a,b){return b.reduce(function(b,c){return b+parseInt(window.getComputedStyle(a)[c])},0)},extend:function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor===Object.prototype.constructor&&(b.prototype.constructor=b)},augment:function(a,b){var c,d;if(arguments[2])for(c=2;c<arguments.length;c++)a.prototype[arguments[c]]=b.prototype[arguments[c]];else for(d in b.prototype)a.prototype[d]=b.prototype[d]},appendFirstChild:function(a,b){a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)},range:function(a,b,c){var d=[];if("undefined"==typeof b&&(b=a,a=0),"undefined"==typeof c&&(c=1),c>0&&a>=b||0>c&&b>=a)return[];for(var e=a;c>0?b>e:e>b;e+=c)d.push(e);return d},remove:function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)},waitCall:function(a,b,c){return function(){var d=b||this,e=[].splice.call(arguments,0);setTimeout(function(){a.apply(d,e)},c||0)}},dictionFactory:function(){var a=[],b=function(b){var c,d;for(c=0;c<a.length;c++)if(d=a[c],d[0]===b)return c;return-1};return{setValue:function(c,d){var e=b(c);return-1!=e?a[e][1]=d:a.push([c,d]),d},getValue:function(c){var d=b(c);return-1!=d?a[d][1]:null},remove:function(c){var d=b(c);return-1!=d?a.splice(d,1)[1]:null},isExist:function(a){var c=b(a);return-1!=c}}},setStyle:function(a,b,c){b=b||{};var d,e="";for(d in b)b.hasOwnProperty(d)&&(e+=d+" : "+b[d]+"; ");c?a.style.cssText+=e:a.style.cssText=e},triggerFactory:function(a){var b,c=[],d={isReverse:!1,isStopOnTrue:!1,context:window};for(b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);return{fire:function(){var a,b,e=[].slice.call(arguments),f=d.isReverse?c.slice().reverse():c;try{for(a=0;a<f.length;a++)if(b=f[a].apply(d.context,e),d.isStopOnTrue&&b)return!0;return!d.isStopOnTrue}catch(g){alert(g.message)}},add:function(a){c.push(a)},remove:function(a){var b=c.indexOf(a);-1!==b&&c.splice(b,1)},reset:function(){c=[]}}},throttle:function(a,b){var c;return function(){var d=[].slice.call(arguments);c&&clearTimeout(c),c=setTimeout(function(){a(d)},b)}},isDisplayed:function(a){return!!a.offsetParent},randomColor:function(){var a=function(){return Math.round(255*Math.random())},b=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b},c=a(),d=a(),e=a();return"#"+b(c)+b(d)+b(e)},createCanvas:function(a,c){var d;return"static"===window.getComputedStyle(a).position&&(a.style.position="relative"),d=document.createElement("canvas"),d.setAttribute("width",c.size.x+"px"),d.setAttribute("height",c.size.y+"px"),b.setStyle(d,{position:"absolute",left:c.position.y+"px",top:c.position.y+"px",width:c.size.x+"px",height:c.size.y+"px"}),b.appendFirstChild(a,d),d}},b.displayHelper=new a,c.util=b,window.MultiDrag=c}(),function(){"use strict";function a(a,b){this.x=a,this.y=b}function b(a,b){this.position=a,this.size=b}var c;a.prototype.toString=function(){return"{x="+this.x+",y="+this.y+"}"},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.mult=function(b){return new a(this.x*b,this.y*b)},a.prototype.negative=function(){return new a(-this.x,-this.y)},a.prototype.compare=function(a){return this.x===a.x&&this.y===a.y},a.prototype.clone=function(){return new a(this.x,this.y)},b.prototype.getP1=function(){return this.position},b.prototype.getP2=function(){return new a(this.position.x+this.size.x,this.position.y)},b.prototype.getP3=function(){return this.position.add(this.size)},b.prototype.getP4=function(){return new a(this.position.x,this.position.y+this.size.y)},b.prototype.getCenter=function(){return this.position.add(this.size.mult(.5))},b.prototype.or=function(c){var d=new a(Math.min(this.position.x,c.position.x),Math.min(this.position.y,c.position.y)),e=new a(Math.max(this.position.x+this.size.x,c.position.x+c.size.x),Math.max(this.position.y+this.size.y,c.position.y+c.size.y)).sub(d);return new b(d,e)},b.prototype.and=function(c){var d=new a(Math.max(this.position.x,c.position.x),Math.max(this.position.y,c.position.y)),e=new a(Math.min(this.position.x+this.size.x,c.position.x+c.size.x),Math.min(this.position.y+this.size.y,c.position.y+c.size.y)).sub(d);return e.x<=0||e.y<=0?null:new b(d,e)},b.prototype.isOn=function(a){return!(this.position.x>a.x||this.position.x+this.size.x<a.x||this.position.y>a.y||this.position.y+this.size.y<a.y)},b.prototype.moveToBound=function(a,b){var c,d,e,f,g,h;if(b)c=b;else{if(d=this.and(a),!d)return a;c=d.size.x>d.size.y?"y":"x"}return e=this.getCenter(),f=a.getCenter(),g=e[c]>f[c]?-1:1,h=g>0?this.position[c]+this.size[c]-a.position[c]:this.position[c]-(a.position[c]+a.size[c]),a.position[c]=a.position[c]+h,a},b.prototype.getSquare=function(){return this.size.x*this.size.y},b.prototype.styleApply=function(a){a=a||document.querySelector("ind"),a.style.left=this.position.x+"px",a.style.top=this.position.y+"px",a.style.width=this.size.x+"px",a.style.height=this.size.y+"px"},b.prototype.growth=function(a){this.size=this.size.add(a),this.position=this.position.add(a.mult(-.5))},b.prototype.getMinSide=function(){return Math.min(this.size.x,this.size.y)},c={getLength:function(a){return!a||a.x&&a.y&&!a.isTransformationSpace?function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)}:a.x&&a.y&&a.isTransformationSpace?function(b,c){return Math.sqrt(Math.pow(a.x*Math.abs(b.x-c.x),2)+Math.pow(a.y*Math.abs(b.y-c.y),2))}:a.x?function(a,b){return Math.abs(a.x-b.x)}:a.y?function(a,b){return Math.abs(a.y-b.y)}:void 0},indexOfNearPoint:function(a,b,c,d){var e,f,g,h=0;if(d=d||this.getLength(),0===a.length)return-1;for(e=d(a[0],b),f=0;f<a.length;f++)g=d(a[f],b),e>g&&(e=g,h=f);return c>=0&&e>c?-1:h},bound:function(a,b,c){return Math.max(a,Math.min(b,c))},boundPoint:function(b,c,d){var e=Math.max(b.x,Math.min(c.x,d.x)),f=Math.max(b.y,Math.min(c.y,d.y));return new a(e,f)},directCrossing:function(b,c,d,e){var f,g,h,i,j,k,l;return d.x===e.x&&(f=d,d=b,b=f,f=e,e=c,c=f),b.x===c.x?(h=(e.y-d.y)/(e.x-d.x),j=(e.x*d.y-d.x*e.y)/(e.x-d.x),k=b.x,l=k*h+j,new a(k,l)):(g=(c.y-b.y)/(c.x-b.x),i=(c.x*b.y-b.x*c.y)/(c.x-b.x),h=(e.y-d.y)/(e.x-d.x),j=(e.x*d.y-d.x*e.y)/(e.x-d.x),k=(i-j)/(h-g),l=k*g+i,new a(k,l))},boundOnLine:function(b,d,e){var f,g;return f=c.bound(Math.min(b.x,d.x),Math.max(b.x,d.x),e.x),f!=e.x&&(g=f===b.x?b.y:d.y,e=new a(f,g)),g=c.bound(Math.min(b.y,d.y),Math.max(b.y,d.y),e.y),g!=e.y&&(f=g===b.y?b.x:d.x,e=new a(f,g)),e},getPointInLine:function(b,c,d){var e=c.x-b.x,f=c.y-b.y;return new a(b.x+d*e,b.y+d*f)},getPointInLineByLenght:function(b,c,d){var e=c.x-b.x,f=c.y-b.y,g=d/this.getLength()(b,c);return new a(b.x+g*e,b.y+g*f)},createRectangleFromElement:function(a,c,d,e){var f=this.getSizeOfElement(a,d);return new b(this.getOffset(a,c||a.parentNode,e),f)},getSizeOfElement:function(b,c){var d=parseInt(window.getComputedStyle(b).width),e=parseInt(window.getComputedStyle(b).height);return c||(d+=MultiDrag.util.getSumValueOfStyleRule(b,["padding-left","padding-right","border-left-width","border-right-width"]),e+=MultiDrag.util.getSumValueOfStyleRule(b,["padding-top","padding-bottom","border-top-width","border-bottom-width"])),new a(d,e)},getOffset:function(b,c){var d=b.getBoundingClientRect(),e=c.getBoundingClientRect();return new a(d.left-e.left,d.top-e.top)},getPointFromRadialSystem:function(b,c,d){return d=d||new a(0,0),d.add(new a(c*Math.cos(b),c*Math.sin(b)))},addPointToBoundPoints:function(a,b,c){var d,e=a.filter(function(a){return a.y>b.y||(c?a.x<b.x:a.x>b.x)});for(d=0;d<e.length;d++)if(b.y<e[d].y)return e.splice(d,0,b),e;return e.push(b),e},getAngle:function(a,b){var c=b.sub(a);return this.normalizeAngle(Math.atan2(c.y,c.x))},toRadian:function(a){return a%360*Math.PI/180},toDegree:function(a){return 180*a/Math.PI%360},boundAngle:function(a,b,c){var d,e;return b>a&&c>a&&b>c?c:a>b&&(b>c||c>a)?c:(d=this.getAngleDiff(a,c),e=this.getAngleDiff(b,c),e>d?a:b)},getNearestAngle:function(a,b){var d,e,f,g=2*Math.PI;for(d=0;d<a.length;d++)e=c.getAngleDiff(a[d],b),e>g&&(g=e,f=a[d]);return f},getAngleDiff:function(a,b){var c=Math.min(a,b),d=Math.max(a,b);return Math.min(d-c,c+2*Math.PI-d)},normalizeAngle:function(a){for(;0>a;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;return a}},window.Point=a,window.Rectangle=b,window.mathPoint=c}(),function(){"use strict";function a(b){switch(b){case c.element:return function(b,d){var e,f=function(){return e.apply(this,arguments)};return f.refresh=function(){e=a(c.rectangle)(mathPoint.createRectangleFromElement(b,d))},f.refresh(),f};case c.rectangle:return function(a){return function(b,c){var d=b.clone(),e=a.getP3();return a.position.x>d.x&&(d.x=a.position.x),a.position.y>d.y&&(d.y=a.position.y),e.x<d.x+c.x&&(d.x=e.x-c.x),e.y<d.y+c.y&&(d.y=e.y-c.y),d}};case c.lineX:return function(a,b,c){return function(d,e){var f=d.clone();return f.x=a,b>f.y&&(f.y=b),c<f.y+e.y&&(f.y=c-e.y),f}};case c.lineY:return function(a,b,c){return function(d,e){var f=d.clone();return f.y=a,b>f.x&&(f.x=b),c<f.x+e.x&&(f.x=c-e.x),f}};case c.line:return function(a,b){var c=Math.atan2(b.y-a.y,b.x-a.x),d=c+Math.PI/2,e=10,f=Math.cos(d),g=Math.sin(d);return function(c,d){var h=new Point(c.x+e*f,c.y+e*g),i=mathPoint.directCrossing(a,b,c,h),j=mathPoint.getPointInLineByLenght(b,a,d.x);return i=mathPoint.boundOnLine(a,j,i)}};case c.unificationOfRectangle:return function(){return function(a){return a.clone()}};case c.circle:return function(a,b){return function(c){var d=mathPoint.getPointInLineByLenght(a,c,b);return console.log(c.toString(),d.toString()),d}};case c.arc:return function(a,b,c,d){return function(e){var f="function"==typeof c?c():c,g="function"==typeof c?d():d,h=mathPoint.getAngle(a,e);return h=mathPoint.normalizeAngle(h),h=mathPoint.boundAngle(f,g,h),mathPoint.getPointFromRadialSystem(h,b,a)}}}}var b=window.MultiDrag||{},c={element:-1,rectangle:0,lineX:1,lineY:2,line:3,unificationOfRectangle:4,circle:5,arc:6};b.boundType=c,b.boundFactory=a,window.MultiDrag=b}(),function(){"use strict";function a(a){switch(a){case d.notCrossing:return function(a,b){var c,d={isRemove:!0};for(c in b)d[c]=b[c];return function(b,c){var d="function"==typeof a?a():a,e=b.reduce(function(a,b,d){return-1===c.indexOf(d)&&a.push(d),a},[]);return c.forEach(function(a){var c=b[a],f=!1;e.forEach(function(a){var d=b[a];c=d.moveToBound(c)}),f=e.some(function(a){var d=b[a];return!!d.and(c)})||c.and(d).getSquare()!==c.getSquare(),f?c.isRemove=!0:e.push(a)}),b}};case d.floatLeft:return function(a,b){var c,d={paddingTopLeft:new Point(5,5),paddingBottomRight:new Point(0,0),isRemove:!0};for(c in b)d[c]=b[c];return function(b){var c,e="function"==typeof a?a():a,f=e.getP2(),g=[e.position];return b.forEach(function(a){var b,h=!1;for(c=0;c<g.length&&(b=new Point(g[c].x,c>0?g[c-1].y:e.position.y).add(d.paddingTopLeft),!(h=b.x+a.size.x<f.x));c++);h||(b=new Point(e.position.x,g[g.length-1].y).add(d.paddingTopLeft)),a.position=b,d.isRemove&&a.getP3().y>e.getP3().y&&(a.isRemove=!0),g=mathPoint.addPointToBoundPoints(g,a.getP3().add(d.paddingBottomRight))}),b}};case d.floatRight:return function(a,b){var c,d,e,f={paddingTopRight:new Point(5,5),paddingBottomLeft:new Point(0,0),isRemove:!0};for(e in b)f[e]=b[e];return c=new Point(-f.paddingTopRight.x,f.paddingTopRight.y),d=new Point(-f.paddingBottomLeft.x,f.paddingBottomLeft.y),function(b){var e,g="function"==typeof a?a():a,h=[g.getRightTopPoint()];return b.forEach(function(a){var b,i=!1;for(e=0;e<h.length&&(b=new Point(h[e].x-a.size.x,e>0?h[e-1].y:g.position.y).add(c),!(i=b.x>a.position.x));e++);i||(b=new Point(g.getP2().x,h[h.length-1].y)),a.position=b,f.isRemove&&a.getLeftBottomPoint().y>g.getP4().y&&(a.isRemove=!0),h=mathPoint.addPointToBoundPoints(h,a.getP4().add(d),!0)}),b}}}}function b(a){switch(a){case d.notCrossing:return function(){return function(a,b,c){var d=a.concat(b);return b.forEach(function(a){c.push(d.indexOf(a))}),d}};case d.floatLeft:case d.floatRight:return function(a,b,c){var d,e={getPosition:function(a){return a.position}};for(d in c)e[d]=c[d];return function(c,d,f){var g,h=c.concat();return g=c.map(e.getPosition),d.forEach(function(d){var f=mathPoint.indexOfNearPoint(g,e.getPosition(d),a,b);f=-1===f?h.length:h.indexOf(c[f]),h.splice(f,0,d)}),d.forEach(function(a){f.push(h.indexOf(a))}),h}}}}var c=window.MultiDrag||{},d={notCrossing:0,floatLeft:1,floatRight:2};c.positionType=d,c.sortingFactory=b,c.positionFactory=a,window.MultiDrag=c}(),function(){"use strict";function a(a,c){c=c||{};var d,e,f=this,g=c.parent||b.util.getDefaultParent(a);this.options={parent:g,bound:b.boundFactory(b.boundType.element)(g,g),startFilter:!1,isReCalculatePosition:!1,isReCalculateSize:!1,isContentBoxSize:!1,position:!1};for(d in c)c.hasOwnProperty(d)&&(this.options[d]=c[d]);this.onEnd=b.util.triggerFactory({context:this,isReverse:!0,isStopOnTrue:!0}),this.onMove=b.util.triggerFactory({context:this}),this.onEnd.add(function(){this.move(this.position,0,!0)}),c.onEnd&&this.onEnd.add(c.onEnd),c.onMove&&this.onMove.add(c.onMove),this.el=a,this.bound=this.options.bound,h(this),b.util.displayHelper.add(this.options.parent,e=function(){f.init(),b.util.displayHelper.remove(f.options.parent,e)})}var b=window.MultiDrag||{},c="ontouchstart"in window,d={start:"mousedown",move:"mousemove",end:"mouseup"},e={start:"touchstart",move:"touchmove",end:"touchend"},f=c?e:d,g=[],h=function(a){var b="for this element MultiDrag.Obj is already exist, don't create it twice ";if(g.some(function(b){return a.el===b.el}))throw b;g.push(a)},i=getStyleProperty("transform"),j=getStyleProperty("transition-duration");a.prototype.init=function(){this._enable=!0,this.offset=mathPoint.getOffset(this.el,this.options.parent,!0),this.fixPosition=this.offset,this.position=this.offset,this.options.position?(this.initPosition=this.options.position,this.move(this.initPosition,0,!0,!0)):this.initPosition=this.offset,this._dragStart=b.util.bind(this.dragStart,this),this._dragMove=b.util.bind(this.dragMove,this),this._dragEnd=b.util.bind(this.dragEnd,this),this.el.addEventListener(f.start,this._dragStart),this.bound.refresh&&this.bound.refresh()},a.prototype.getSize=function(a){return(!this._size||this.options.isReCalculateSize||a)&&(this._size=mathPoint.getSizeOfElement(this.el,this.options.isContentBoxSize)),this._size},a.prototype.getPosition=function(){return(!this.position||this.options.isReCalculatePosition)&&(this.position=this.offset.add(this._transformPosition||new Point(0,0))),this.position},a.prototype.getCenter=function(){return this.position.add(this.getSize().mult(.5))},a.prototype._setTranslate=function(a){this._transformPosition=a;var b=this.el.style[i],c=" translate3d("+a.x+"px,"+a.y+"px, 0px)";/translate3d\([^)]+\)/.test(b)?b=b.replace(/translate3d\([^)]+\)/,c):b+=c,this.el.style[i]=b},a.prototype.move=function(a,b,c,d){var e=this;b=b||0,a=a.clone(),c&&(this.fixPosition=a),this.position=a,requestAnimationFrame(function(){j&&(e.el.style[j]=b+"ms"),e._setTranslate(a.sub(e.offset)),d||e.onMove.fire()})},a.prototype.setPosition=function(a){a=a.clone(),this.position=a,j&&(this.el.style[j]="0ms"),this._setTranslate(a.sub(this.offset))},a.prototype.dragStart=function(a){!this._enable||this.options.startFilter&&!this.options.startFilter(a)||(this._startTouchPoint=new Point(c?a.changedTouches[0].pageX:a.clientX,c?a.changedTouches[0].pageY:a.clientY),this._startPosition=this.getPosition(),c&&(this._touchId=a.changedTouches[0].identifier),a.stopPropagation(),a.target instanceof HTMLInputElement||a.target instanceof HTMLInputElement?a.target.focus():a.preventDefault(),document.addEventListener(f.move,this._dragMove),document.addEventListener(f.end,this._dragEnd),this.isMultiDrag=!0,b.util.addClass(this.el,"active"),this.onMove.fire())},a.prototype.dragMove=function(a){var d,e,f;(!c||(d=b.util.getTouchByID(a,this._touchId)))&&(a.stopPropagation(),a.preventDefault(),e=new Point(c?d.pageX:a.clientX,c?d.pageY:a.clientY),f=this._startPosition.add(e.sub(this._startTouchPoint)),f=this.bound(f,this.getSize()),this.move(f,0))},a.prototype.dragEnd=function(a){var d;(!c||(d=b.util.getTouchByID(a,this._touchId)))&&(a.stopPropagation(),a.preventDefault(),this.onEnd.fire(),document.removeEventListener(f.move,this._dragMove),document.removeEventListener(f.end,this._dragEnd),this.isMultiDrag=!1,b.util.removeClass(this.el,"active"))},a.prototype.changeHtmlParent=function(a){this._initialParent||(this._initialParent=this.el.parentNode),this.el.parentNode!==a&&(a.appendChild(this.el),b.util.waitCall(function(){this.offset=mathPoint.getOffset(this.el,this.options.parent,!0).sub(this._transformPosition),this.move(this.position,0,!1,!0)},this)())},a.prototype.getRectangle=function(){return new Rectangle(this.position,this.getSize())},a.prototype.refresh=function(){this.getSize(!0),this.bound.refresh&&this.bound.refresh()},a.prototype.destroy=function(){this.el.removeEventListener(f.start,this._dragStart),this.onEnd.reset(),this.onMove.reset()},a.prototype.__defineGetter__("enable",function(){return this._enable}),a.prototype.__defineSetter__("enable",function(a){return b.util.toggleClass(this.el,"disable",!a),this._enable=a}),b.objs=g,b.Obj=a,window.MultiDrag=b}(),function(){"use strict";function a(a,b){var e;this.options={timeEnd:200,timeExcange:400,radius:30,getLength:mathPoint.getLength(),isDisplacement:!1};for(e in b)b.hasOwnProperty(e)&&(this.options[e]=b[e]);this.objs=a,d.push(this),this.onChange=c.util.triggerFactory({context:this}),b&&b.onChange&&this.onChange.add(b.onChange),this.init()}function b(b,d,e){var f,g,h;return e=e||{},g=e.obj||{},h=e.list||{},g.parent=g.parent||b,d=Array.prototype.slice.call(d),f=d.map(function(a){return new c.Obj(a,g)}),new a(f,h)}var c=window.MultiDrag||{},d=[];a.prototype.init=function(){this._enable=!0,this.objs.forEach(this.initObj,this)},a.prototype.initObj=function(a){var b,c=this;a.enable=this._enable,this.options.isDisplacement?(b=function(){return this.isMultiDrag?(c.onStart(this),a.onMove.remove(b),!0):void 0},a.onEnd.add(function(){return c.onEndDisplaycement(this),a.onMove.add(b),!0}),a.onMove.add(b)):a.onEnd.add(function(){return c.onEnd(this),!0})},a.prototype.moveOrSave=function(a,b,c){a.isMultiDrag?a.fixPosition=b:a.move(b,c,!0)},a.prototype.onEnd=function(a){var b,c,d=this.getCurrentFixPosition();return b=this.objs.indexOf(a),c=mathPoint.indexOfNearPoint(d,a.position,this.options.radius,this.options.getLength),-1===c||c===b?a.move(a.fixPosition,this.options.timeEnd,!0):(this.moveOrSave(this.objs[c],d[b],this.options.timeExcange),this.objs[b].move(d[c],this.options.timeEnd,!0),this.onChange.fire()),!0},a.prototype.onEndDisplaycement=function(a){var b,c,d,e=this.getSortedObjs(),f=e.map(function(a){return a.fixPosition});if(b=e.indexOf(a),d=mathPoint.indexOfNearPoint(f,a.position,this.options.radius,this.options.getLength),-1!==d){if(b>d)for(c=d;b>c;c++)this.moveOrSave(e[c],f[c+1],this.options.timeExcange);else for(c=b;d>c;c++)this.moveOrSave(e[c+1],f[c],this.options.timeExcange);a.move(f[d],this.options.timeEnd,!0)}else a.move(a.fixPosition,this.options.timeEnd,!0)},a.prototype.onStart=function(a){var b,c,d=this.getSortedObjs(),e=d.map(function(a){return a.fixPosition});for(b=d.indexOf(a),c=b+1;c<d.length;c++)this.moveOrSave(d[c],e[c-1],this.options.timeExcange);d[b].fixPosition=e[c-1]},a.prototype.getCurrentFixPosition=function(){return this.objs.map(function(a){return a.fixPosition.clone()})},a.prototype.getSortedObjs=function(){var a,b=this.objs.map(function(a){return a.initPosition});return a=b.map(function(a){return this.objs.filter(function(b){return b.fixPosition.compare(a)},this)[0]},this)},a.prototype.reset=function(){this.objs.forEach(function(a){a.move(a.initPosition,0,!0,!1)})},a.prototype.refresh=function(){this.objs.forEach(function(a){a.refresh()})},a.prototype.add=function(a){a instanceof Array||(a=[a]),a.forEach(this.initObj,this),this.objs=this.objs.concat(a)},a.prototype.remove=function(a){var b,d=this.objs.map(function(a){return a.initPosition}),e=[],f=this.getSortedObjs();a instanceof Array||(a=[a]),a.forEach(function(a){a.onEnd.reset(),a.onMove.reset(),c.util.remove(this.objs,a)},this),b=0,f.forEach(function(a){-1!==this.objs.indexOf(a)&&(a.fixPosition!==d[b]&&a.move(d[b],this.options.timeExcange,!0),a.initPosition=d[b],b++,e.push(a))},this),this.objs=e},a.prototype.clear=function(){this.remove(this.objs.slice())},a.prototype.destroy=function(){this.objs.forEach(function(a){a.destroy()})},a.prototype.__defineGetter__("positions",function(){return this.getCurrentFixPosition()}),a.prototype.__defineSetter__("positions",function(a){var b="wrong array length";if(a.length!==this.objs.length)throw alert(b),b;a.forEach(function(a,b){this.objs[b].move(a,0,!0,!0)},this)}),a.prototype.__defineGetter__("enable",function(){return this._enable}),a.prototype.__defineSetter__("enable",function(a){this._enable=a,this.objs.forEach(function(b){b.enable=a})}),c.lists=d,c.List=a,c.listFactory=b,window.MultiDrag=c}(),function(){"use strict";function a(a,b){b=b||{},b.stepOn=b.stepOn||new Point(-50,0),c.List.call(this,a,b)}function b(b,d,e){var f,g,h;return e=e||{},g=e.obj||{},h=e.list||{},g.parent=g.parent||b,d=Array.prototype.slice.call(d),f=d.map(function(a){return new c.Obj(a,g)}),new a(f,h)}var c=window.MultiDrag||{};c.util.extend(a,c.List),a.prototype.init=function(){var a=this;this.objs.forEach(function(b){b.isOn=!1,b.onEnd.add(function(){return a.onEnd(this),!0})})},a.prototype.onEnd=function(a){var b,c,d=this.getCurrentFixPositionWithOff();return b=this.objs.indexOf(a),c=mathPoint.indexOfNearPoint(d,a.position,this.options.radius,this.options.getLength),-1===c||c===b?this.moveObj(b,a.position,d[b],this.options.timeEnd):(this.objs[c].isMultiDrag?this.fixToOff(c,d[b]):this.moveObjToOff(c,d[b],this.options.timeExcange),this.moveObj(b,a.position,d[c],this.options.timeEnd),this.onChange.fire()),!0},a.prototype.moveObj=function(a,b,c,d){var e=[c,c.add(this.options.stepOn)],f=mathPoint.indexOfNearPoint(e,b,-1,mathPoint.getLength({x:!0}));this.objs[a].isOn!==!!f&&(this.objs[a].isOn=!!f,this.onChange.fire()),this.objs[a].move(e[f],d,!0)},a.prototype.fixToOff=function(a,b){this.objs[a].isOn=!1,this.objs[a].fixPosition=b},a.prototype.moveObjToOff=function(a,b,c){this.objs[a].isOn=!1,this.objs[a].move(b,c,!0)},a.prototype.getCurrentFixPositionWithOff=function(){return this.objs.map(function(a){return a.isOn?a.fixPosition.sub(this.options.stepOn):a.fixPosition.clone()},this)},a.prototype.getSortedObjs=function(){return this.objs.map(function(a){return a.initPosition}).map(function(a){return this.objs.filter(function(b){return b.fixPosition.compare(a)||b.fixPosition.compare(a.add(this.options.stepOn))},this)[0]},this)},a.prototype.reset=function(){this.objs.forEach(function(a){a.move(a.initPosition,0,!0,!1),a.isOn=!1})},a.prototype.__defineGetter__("positions",function(){return this.objs.map(function(a){var b=a.fixPosition.clone();return b.isOn=a.isOn,b})}),a.prototype.__defineSetter__("positions",function(a){var b="wrong array length";if(a.length!==this.objs.length)throw alert(b),b;a.forEach(function(a,b){this.objs[b].isOn=a.isOn,this.objs[b].move(a,0,!0,!0)},this)}),c=c||{},c.ListSwitcher=a,c.listSwitcherFactory=b,window.MultiDrag=c}(),function(){"use strict";function a(a,b,d){var e,f=mathPoint.createRectangleFromElement(a,a);this.options={angle:0,dAngle:2*Math.PI/b.length,center:f.getCenter(),startRadius:50,endRadius:f.getMinSide()/2,lineWidth:2,strokeStyle:"#ff5577",fillStyle:"rgba(150,255,50,0.8)"};for(e in d)d.hasOwnProperty(e)&&(this.options[e]=d[e]);c.push(this),this.area=a,this.areaRectangle=f,this.init(b)}var b=window.MultiDrag||{},c=[];a.prototype.init=function(a){var c=this;this.canvas=b.util.createCanvas(this.area,this.areaRectangle),this.context=this.canvas.getContext("2d"),this.objs=a.map(function(a,d){var e=this.options.angle+d*this.options.dAngle,f=mathPoint.getSizeOfElement(a).mult(.5),g=mathPoint.getPointFromRadialSystem(e,this.options.startRadius,this.options.center).sub(f),h=mathPoint.getPointFromRadialSystem(e,this.options.endRadius,this.options.center).sub(f),i=function(){return b.boundFactory(b.boundType.line)(g,h)};return new b.Obj(a,{parent:this.area,bound:i,position:g,onMove:function(){return c.draw(),!0}})},this),this.isInit=!0,this.draw()},a.prototype.draw=function(){var a,b;if(this.isInit){for(this.context.clearRect(0,0,this.areaRectangle.size.x,this.areaRectangle.size.y),this.context.beginPath(),a=this.objs[0].getCenter(),this.context.moveTo(a.x,a.y),b=0;b<this.objs.length;b++)a=this.objs[b].getCenter(),this.context.lineTo(a.x,a.y);this.context.closePath(),this.context.lineWidth=this.options.lineWidth,this.context.strokeStyle=this.options.strokeStyle,this.context.stroke(),this.context.fillStyle=this.options.fillStyle,this.context.fill()}},b.spiders=c,b.Spider=a,window.MultiDrag=b}(),function(){"use strict";function a(a,d,e){e=e||{};var f,g=e.parent||b.util.getDefaultParent(a);this.options={timeEnd:200,timeExcange:400,isReCalculateRectangle:!1,parent:g,isChangeHtmlParent:!1,sorting:b.sortingFactory(b.positionType.floatLeft)(80,mathPoint.getLength({x:1,y:4,IsTransformationSpace:!0})),positioning:b.positionFactory(b.positionType.floatLeft)(b.util.bind(this.getRectangle,this),{isRemove:!0})};for(f in e)this.options[f]=e[f];c.push(this),this.el=a,this.objs=d,this.onAdd=b.util.triggerFactory({context:this}),this.onRemove=b.util.triggerFactory({context:this}),e.onRemove&&this.onRemove.add(e.onRemove),e.onAdd&&this.onAdd.add(e.onAdd),this.init()}var b=window.MultiDrag||{},c=[];a.prototype.getRectangle=function(){return(!this._rectangle||this.options.isReCalculateRectangle||this.options.isChangeHtmlParent)&&(this._rectangle=mathPoint.createRectangleFromElement(this.el,this.options.parent,this.options.isContentBoxSize,!0)),this._rectangle},a.prototype.init=function(){var a,c;this.objOnMoveDictionary=b.util.dictionFactory(),this.innerObjs=this.objs.filter(function(a){for(var b=a.el.parentNode;b;){if(b===this.el)return!0;b=b.parentNode}return!1},this),this.innerObjs.length&&(c=b.util.range(this.innerObjs.length),a=this.options.positioning(this.innerObjs.map(function(a){return a.getRectangle()}),c),this.setPosition(a,c),this.innerObjs.forEach(function(a){this.onAdd.fire(a)},this))},a.prototype.refresh=function(){var a=this.options.positioning(this.innerObjs.map(function(a){return a.getRectangle()}),[]);this.setPosition(a,[])},a.prototype.onEnd=function(a){var b,c=[],d=this.getRectangle().isOn(a.getCenter());return d?(this.innerObjs=this.options.sorting(this.innerObjs,[a],c),b=this.options.positioning(this.innerObjs.map(function(a){return a.getRectangle()}),c),this.setPosition(b,c),-1!==this.innerObjs.indexOf(a)&&this.addRemoveOnMOve(a),!0):!1},a.prototype.setPosition=function(a,c,d){this.innerObjs.slice(0).forEach(function(e,f){var g=a[f],h=this,i=d||0==d?d:-1!==c.indexOf(f)?this.options.timeEnd:this.options.timeExcange;g.isRemove?(e.move(e.initPosition,i,!0,!0),b.util.remove(this.innerObjs,e),this.options.isChangeHtmlParent&&e._initialParent&&setTimeout(function(){e.changeHtmlParent(e._initialParent)},d+10),this.onRemove.fire(e)):(e.move(g.position,i,!0,!0),this.options.isChangeHtmlParent&&setTimeout(function(){e.changeHtmlParent(h.el)},d+10))},this)},a.prototype.add=function(a,b){var c,d=this.innerObjs.length;this.innerObjs.push(a),c=this.options.positioning(this.innerObjs.map(function(a){return a.getRectangle()}),d),this.setPosition(c,[d],b||0),-1!==this.innerObjs.indexOf(a)&&this.addRemoveOnMOve(a)},a.prototype.addRemoveOnMOve=function(a){var b=this;a.onMove.add(this.objOnMoveDictionary.setValue(a,function(){return b.remove(this)})),this.onAdd.fire(a)},a.prototype.remove=function(a){var b,c;a.onMove.remove(this.objOnMoveDictionary.remove(a)),b=this.innerObjs.indexOf(a),-1!==b&&(this.innerObjs.splice(b,1),c=this.options.positioning(this.innerObjs.map(function(a){return a.getRectangle()}),[]),this.setPosition(c,[]),this.onRemove.fire(a))},a.prototype.reset=function(){this.innerObjs.forEach(function(a){a.move(a.initPosition,0,!0,!0),this.onRemove.fire(a)},this),this.innerObjs=[]},a.prototype.getSortedObjs=function(){this.innerObjs.slice()},b.targets=c,b.Target=a,window.MultiDrag=b}(),function(){"use strict";function a(a,b,e,f){var g;this.el=a,this.objs=b,this.targets=e,d.push(this),this.options={isChangeHtmlParent:!1,timeEnd:400,timeWaitForRefresh:500};for(g in f)f.hasOwnProperty(g)&&(this.options[g]=f[g]);this.onChange=c.util.triggerFactory({context:this}),f&&f.onChange&&this.onChange.add(f.onChange),this.init()}function b(b,d,e,f){var g,h,i,j,k;return f=f||{},i=f.obj||{},j=f.target||{},k=f.manager||{},i.parent=i.parent||b,j.parent=j.parent||b,d=Array.prototype.slice.call(d),e=Array.prototype.slice.call(e),g=d.map(function(a){return new c.Obj(a,i)}),h=e.map(function(a){return new c.Target(a,g,j)}),new a(b,g,h,k)}var c=window.MultiDrag||{},d=[];a.prototype.init=function(){var a=this;this.objs.forEach(function(b){b.onEnd.add(function(){return a.onEnd(this)}),b.onMove.add(function(){return a.onMove(this)})})},a.prototype.onMove=function(){},a.prototype.onEnd=function(a){var b=this.targets.filter(function(b){return-1!==b.objs.indexOf(a)}).filter(function(b){var c=b.getRectangle(),d=a.getRectangle().getSquare();return d<c.getSquare()&&c.isOn(a.getCenter())}).sort(function(a,b){return a.getRectangle().getSquare()-b.getRectangle().getSquare()});return b.length?b[0].onEnd(a):(a.move(a.initPosition,this.options.timeEnd,!0,!0),this.options.isChangeHtmlParent&&a._initialParent&&setTimeout(function(){a.changeHtmlParent(a._initialParent)},this.options.timeEnd+10)),this.onChange.fire(),!0},a.prototype.reset=function(){this.targets.forEach(function(a){a.reset()})},a.prototype.refresh=function(){this.objs.forEach(function(a){a.refresh()}),this.targets.forEach(function(a){a.refresh()})},a.prototype.__defineGetter__("positions",function(){return this.targets.map(function(a){return a.innerObjs.map(function(a){return this.objs.indexOf(a)},this)},this)}),a.prototype.__defineSetter__("positions",function(a){var b="wrong array length";
if(a.length!==this.targets.length)throw alert(b),b;this.targets.forEach(function(a){a.reset()},this),a.forEach(function(a,b){a.forEach(function(a){this.targets[b].add(this.objs[a])},this)},this)}),c.targetManagers=d,c.TargetManager=a,c.targetManagerFactory=b,window.MultiDrag=c}();